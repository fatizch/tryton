# vim: set ft=sh:
# init new environment

coog_init_bin() { # link useful bin to venv (tryton, coog, upload.py, etc)
        [ -z $VIRTUAL_ENV ] && echo not in a virtual env, nothing to do && return
        local wd
        wd=`pwd`
        cd $VIRTUAL_ENV/bin
        [ -h trytond ] && rm trytond
        ln -s `readlink -f $wd/../../trytond/bin/trytond` .
        [ -h run-tests.py ] && rm run-tests.py
        ln -s `readlink -f $wd/../../trytond/trytond/tests/run-tests.py` .
        [ -h tryton ] && rm tryton
        ln -s `readlink -f $wd/../../tryton/bin/tryton` .
        [ -h coog ] && rm coog
        ln -s $wd/coog .
        [ -h upload.py ] && rm upload.py
        ln -s $wd/vendor/upload.py
        [ -h git-cl ] && rm git-cl
        ln -s $wd/vendor/git-cl
        cd $wd
}

_coog_init_conf_cp() {
        if [ -f ../../conf/$1 ]
        then
                cp .conf/$1 ../../conf/$1".ini"
        else
                cp .conf/$1 ../../conf/
        fi
}

coog_init_conf() { # set default conf
        [ ! -d ../../conf ] && mkdir ../../conf
        _coog_init_conf_cp trytond.conf
        _coog_init_conf_cp test.conf
        _coog_init_conf_cp tryton.conf
        _coog_init_conf_cp logging.conf
        # TODO: review - batch
        _coog_init_conf_cp batch.conf
        _coog_init_conf_cp celeryconfig.py
}

coog_init_redmine() { # init redmine credentials
        local username
        read -p "Enter Redmine username: " username
        local password
        read -p "Enter Redmine password: " password
        echo "export COOG_REDMINE_CRED=$username:$password" >> ~/.profile
        echo "now restart your session or source ~/.profile"
}
