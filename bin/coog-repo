# vim: set ft=sh:
# repositories/projects management - link, git actions, etc

_coog_repo_enter_modules() { # move to trytond modules folder
        _coog_repo_wd=`pwd`
        cd $COOG_TRYTOND/trytond/modules
}

_coog_repo_enter_plugins() { # move to tryton plugins folder
        _coog_repo_wd=`pwd`
        cd $COOG_TRYTON/tryton/plugins
}

_coog_repo_leave() { # move back to initial wd
        cd $_coog_repo_wd
}

_coog_repo_rm() { # remove all links from wd
        find -type l -delete
}

_coog_repo_list() { # list repositories
        local f
        for f in $COOG_ROOT/*
        do
                [ -d $f ] && [ -d $f/modules ] && basename $f
        done
}

coog_repo_main() { # list repositories
        _coog_repo_list
}

_coog_repo_link_repos() { # guess modules list from link args
        if [ $# -eq 0 ]
        then
                echo `_coog_repo_list`
        else
                echo $@
        fi
}

coog_repo_linkm() { # link repos modules - <repos> - default: all
        local repos
        local repo
        repos=`_coog_repo_link_repos $*`
        _coog_repo_enter_modules
        [ $# -eq 0 ] && _coog_repo_rm
        for repo in $repos
        do
                [ -d $COOG_ROOT/$repo/modules ] && ln -s $COOG_ROOT/$repo/modules/* .
        done
        _coog_repo_leave
}

coog_repo_linkp() { # link repos plugins - <repos> - default: all
        local repos
        local repo
        repos=`_coog_repo_link_repos $*`
        _coog_repo_enter_plugins
        [ $# -eq 0 ] && _coog_repo_rm
        for repo in $repos
        do
                [ -d $COOG_ROOT/$repo/plugins ] && ln -s $COOG_ROOT/$repo/plugins/* .
        done
        _coog_repo_leave
}

coog_repo_link() { # link repos - <repos> - default: all
        coog_repo_linkm $*
        coog_repo_linkp $*
}

coog_repo_unlinkm() { # unlink all repos modules
        _coog_repo_enter_modules
        _coog_repo_rm
        _coog_repo_leave
}

coog_repo_unlinkp() { # unlink all repos plugins
        _coog_repo_enter_plugins
        _coog_repo_rm
        _coog_repo_leave
}

coog_repo_unlink() { # unlink all repos
        coog_repo_unlinkm
        coog_repo_unlinkp
}
