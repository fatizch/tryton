# vim: set ft=sh:
# repositories/projects management - link, git actions, etc

_coog_repo_enter_modules() { # move to trytond modules folder
        _coog_repo_wd=`pwd`
        cd ../../trytond/trytond/modules
}

_coog_repo_enter_plugins() { # move to tryton plugins folder
        _coog_repo_wd=`pwd`
        cd ../../tryton/tryton/plugins
}

_coog_repo_leave() { # move back to initial wd
        cd $_coog_repo_wd
}

_coog_repo_rm() { # remove all links from wd
        find -type l -delete
}

_coog_repo_list() { # list repositories
        local f
        for f in ../../*
        do
                [ -d $f ] && [ -d $f/modules ] && echo `echo $f | cut -d '/' -f 3`
        done
}

coog_repo_main() { # list repositories
        _coog_repo_list
}

coog_repo_link() { # link repositories <args> - default: all
        local repos
        local repo
        if [ $# -eq 0 ]
        then
                repos=`_coog_repo_list`
        else
                repos=$@
        fi
        _coog_repo_enter_modules
        _coog_repo_rm
        for repo in $repos
        do
                ln -s ../../../$repo/modules/* .
        done
        _coog_repo_leave
        _coog_repo_enter_plugins
        _coog_repo_rm
        for repo in $repos
        do
                [ -d ../../../$repo/plugins ] && ln -s ../../../$repo/plugins/* .
        done
        _coog_repo_leave
}

coog_repo_unlink() { # unlink all repositories
        _coog_repo_enter_modules
        _coog_repo_rm
        _coog_repo_leave
        _coog_repo_enter_plugins
        _coog_repo_rm
        _coog_repo_leave
}
