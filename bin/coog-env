# vim: set ft=sh:
# environment informations

_coog_env_files() { # set file names
        COOG_SRV_FILE=coog-srv-$USER
        COOG_CLI_FILE=coog-cli-$USER
        if [ ! -z $VIRTUAL_ENV ]
        then
                local venv
                venv=`basename $VIRTUAL_ENV`
                COOG_SRV_FILE=$COOG_SRV_FILE-$venv
                COOG_CLI_FILE=$COOG_CLI_FILE-$venv
        else
                echo warn: running outside a virtual env
        fi
}

_coog_env_paths() { # set paths
        local conf
        conf=`readlink -f ../../conf`
        COOG_TMP=/tmp
        COOG_SRV_CONF=$conf/trytond.conf
        COOG_TEST_CONF=$conf/test.conf
        COOG_CLI_CONF=$conf/tryton.conf
        COOG_LOG_CONF=$conf/logging.conf
        COOG_LOG_LEVEL=`python2 .py/env-config.py $COOG_LOG_CONF logger_root level str`
}

_coog_env_python() { # set python paths
        export PYTHONUNBUFFERED=1
}

_coog_env_pg() { # set pg vars
        local vars
        vars=`python2 .py/env-config.py $COOG_SRV_CONF database uri url`
        export PGHOST=`echo "$vars" | sed -n 1p`
        export PGPORT=`echo "$vars" | sed -n 2p`
        export PGUSER=`echo "$vars" | sed -n 3p`
        export PGPASSWORD=`echo "$vars" | sed -n 4p`
        export PGDATABASE=`echo "$vars" | sed -n 5p`
}

_coog_env_files
_coog_env_paths
_coog_env_python
_coog_env_pg

coog_env_celery() { # set trytond and celery config in pythonpath
        # TODO: review - batch
        local conf_path
        conf_path=`readlink -f ../../conf`
        local trytond_path
        trytond_path=`readlink -f ../../trytond`
        local proteus_path
        proteus_path=`readlink -f ../../proteus`
        export PYTHONPATH=$conf_path:$trytond_path:$proteus_path:$PYTHONPATH
}

coog_env_main() { # print meaningful vars for coog execution
        echo Environment variables:
        echo
        echo "    COOG_SRV_FILE     "$COOG_SRV_FILE
        echo "    COOG_CLI_FILE     "$COOG_CLI_FILE
        echo "    COOG_TMP          "$COOG_TMP
        echo "    COOG_SRV_CONF     "$COOG_SRV_CONF
        echo "    COOG_TEST_CONF    "$COOG_TEST_CONF
        echo "    COOG_CLI_CONF     "$COOG_CLI_CONF
        echo "    COOG_LOG_CONF     "$COOG_LOG_CONF
        echo "    COOG_LOG_LEVEL    "$COOG_LOG_LEVEL
        echo "    PYTHONUNBUFFERED  "$PYTHONUNBUFFERED
        echo "    PGHOST            "$PGHOST
        echo "    PGPORT            "$PGPORT
        echo "    PGUSER            "$PGUSER
        echo "    PGPASSWORD        "$PGPASSWORD
        echo "    PGDATABASE        "$PGDATABASE
}
