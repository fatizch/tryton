<?xml version="1.0" encoding="utf-8"?>
<!-- This file is part of Coog. The COPYRIGHT file at the top level of
this repository contains the full copyright notices and license terms. -->
<tryton>
    <data>
        <record model="rule_engine.function" id="service_basic_salary">
            <field name="translated_technical_name">tranche_salaire</field>
            <field name="description">Tranche de salaire</field>
            <field name="type">function</field>
            <field name="language" ref="ir.lang_fr"/>
            <field name="namespace">rule_engine.runtime</field>
            <field name="name">_re_basic_salary</field>
            <field name="fct_args">liste_des_type_de_salaire, avec_revalorisation</field>
            <field name="long_description">Retourne un dictionnaire avec les 
clés 'TA', TB', 'TC' pour les différentes tranches de salaire. Cette donnée 
prend en paramètre une liste de définition des salaires parmi 
'gross_salary' (salaire brut), 'net_salary' (salaire net), 'salary_bonus' 
(prime brutte), 'net_salary_bonus' (prime nette). Si le paramètre avec_revalorisation 
est à vrai alors Coog va appliquer la revalorisation au traitement de base si 
elle est définie sur le traitement de base (par défaut cette donnée est à vrai)</field>
            <field name="parent" ref="claim.dossier_sinistre"/>
        </record>
        <record model="rule_engine.function" id="salary_range_rate">
            <field name="translated_technical_name">taux_de_la_tranche</field>
            <field name="description">Taux de la tranche</field>
            <field name="type">function</field>
            <field name="language" ref="ir.lang_fr"/>
            <field name="namespace">rule_engine.runtime</field>
            <field name="name">_re_get_range_by_name</field>
            <field name="fct_args">nom_de_tranche, contribution_fixe, listes_des_code_des_contributions</field>
            <field name="long_description">Retourne la somme des taux des 
contributions pour le calcul du salaire net. Cette donnée prend en paramètre 
le nom de la tranche de salaire ('A', 'B', 'C'), un boolean pour indiquer si 
il s'agit de taux en pourcentage ou une somme de montant (par défaut à faux), 
une liste des codes des contributions à additionner (par défaut à vide: 
dans ce cas l'ensemble des contributions est sommée)</field>
            <field name="parent" ref="claim.dossier_sinistre"/>
        </record>
        <record model="rule_engine.function" id="salary_gross_salary">
            <field name="translated_technical_name">salaire_brut</field>
            <field name="description">Salaire brut</field>
            <field name="type">function</field>
            <field name="language" ref="ir.lang_fr"/>
            <field name="namespace">rule_engine.runtime</field>
            <field name="name">_re_get_gross_salary</field>
            <field name="long_description">Retourne le montant du salaire brut</field>
            <field name="parent" ref="claim.dossier_sinistre"/>
        </record>
        <record model="rule_engine.function" id="salary_net_salary">
            <field name="translated_technical_name">salaire_net</field>
            <field name="description">Salaire net</field>
            <field name="type">function</field>
            <field name="language" ref="ir.lang_fr"/>
            <field name="namespace">rule_engine.runtime</field>
            <field name="name">_re_get_net_salary</field>
            <field name="long_description">Retourne le montant du salaire net</field>
            <field name="parent" ref="claim.dossier_sinistre"/>
        </record>
        <record model="rule_engine.function" id="salary_net_limit">
            <field name="translated_technical_name">limite_au_net</field>
            <field name="description">Limite au net</field>
            <field name="type">function</field>
            <field name="language" ref="ir.lang_fr"/>
            <field name="namespace">rule_engine.runtime</field>
            <field name="name">_re_is_net_limite</field>
            <field name="long_description">Retourne vrai si la garantie 
prévoit une limitation au salaire net</field>
            <field name="parent" ref="claim.dossier_sinistre"/>
        </record>
        <record model="rule_engine.function" id="revaluation_on_basic_salary">
            <field name="translated_technical_name">revalorisation_sur_traitement_de_base</field>
            <field name="description">Revalorisation sur le traitement de base</field>
            <field name="type">function</field>
            <field name="language" ref="ir.lang_fr"/>
            <field name="namespace">rule_engine.runtime</field>
            <field name="name">_re_revaluation_on_basic_salary</field>
            <field name="long_description">Vrai si la revalorisation s'effectue sur le traitement de base</field>
            <field name="parent" ref="claim.dossier_sinistre"/>
        </record>
        <!-- DEFAULT NET SALARY COMPUTATION RULES -->
        <record model="rule_engine" id="net_salary_calculation_a_payer">
            <field name="name">Calcul du salaire NET (A payer)</field>
            <field name="short_name">coog_net_salary_calculation_a_payer</field>
            <field name="algorithm">tranches = tranche_salaire(['gross_salary', 'salary_bonus'])
TRA = tranches['TA']
TRB = tranches['TB']
TRC = tranches['TC']

#calcul des contributions salariales
contrib_salariales = ['4_chomage_1', '4_chomage_2', 
    '3_prevoyance_1', '3_prevoyance_2', '2_retraite_1', '2_retraite_2', '1_urssaf_1', '1_urssaf_2', '1_urssaf_3', '1_urssaf_4',
    '6_charges_salariales_sante_taux']
TA = taux_de_la_tranche('A', fixed=False, codes_list=contrib_salariales) or 0
TB = taux_de_la_tranche('B', fixed=False, codes_list=contrib_salariales) or 0
TC = taux_de_la_tranche('C', fixed=False, codes_list=contrib_salariales) or 0

salaire_net = TRA * (1 - TA/100) + TRB * (1 - TB/100) + TRC * (1 - TC/100)

#calcul de la CSG/RDS
contrib_patronales = ['5_charges_patronales_prevoyance', '6_charges_patronales_sante_taux']
assiette_csg_rds = 0.9825*(TRA + TRB + TRC) + taux_de_la_tranche('A', fixed=False, codes_list=contrib_patronales) * TRA / 100 + \
     taux_de_la_tranche('B', fixed=False, codes_list=contrib_patronales) * TRB / 100 + \
     taux_de_la_tranche('C', fixed=False, codes_list=contrib_patronales) * TRC / 100
assiette_csg_rds += taux_de_la_tranche(fixed=True, codes_list=['2_charges_patronales_sante_montant'])
salaire_net -= assiette_csg_rds * (0.005 + 0.051 + 0.024)

#Enlever le montant de la prévoyance
salaire_net -= taux_de_la_tranche(fixed=True, codes_list=['1_charges_salariales_mutuelle'])

return arrondir(salaire_net, 0.01)</field>
            <field name="status">validated</field>
            <field name="type_">benefit_net_salary_calculation</field>
            <field name="context" ref="rule_engine.default_context"/>
        </record>
        <record model="rule_engine" id="net_salary_calculation_imposable">
            <field name="name">Calcul du salaire NET (Imposable)</field>
            <field name="short_name">coog_net_salary_calculation_imposable</field>
            <field name="algorithm">tranches = tranche_salaire(['gross_salary', 'salary_bonus'])
TRA = tranches['TA']
TRB = tranches['TB']
TRC = tranches['TC']

#calcul des contributions salariales
contrib_salariales = ['4_chomage_1', '4_chomage_2', 
    '3_prevoyance_1', '3_prevoyance_2', '2_retraite_1', '2_retraite_2', '1_urssaf_1', '1_urssaf_2', '1_urssaf_3', '1_urssaf_4']
TA = taux_de_la_tranche('A', fixed=False, codes_list=contrib_salariales) or 0
TB = taux_de_la_tranche('B', fixed=False, codes_list=contrib_salariales) or 0
TC = taux_de_la_tranche('C', fixed=False, codes_list=contrib_salariales) or 0

salaire_net = TRA * (1 - TA/100) + TRB * (1 - TB/100) + TRC * (1 - TC/100)

#calcul de la CSG/RDS
contrib_patronales = ['5_charges_patronales_prevoyance', '6_charges_patronales_sante_taux']
assiette_csg_rds = 0.9825*(TRA + TRB + TRC) + taux_de_la_tranche('A', fixed=False, codes_list=contrib_patronales) * TRA / 100 + \
     taux_de_la_tranche('B', fixed=False, codes_list=contrib_patronales) * TRB / 100 + \
     taux_de_la_tranche('C', fixed=False, codes_list=contrib_patronales) * TRC / 100
assiette_csg_rds += taux_de_la_tranche(fixed=True, codes_list=['2_charges_patronales_sante_montant'])
salaire_net -= assiette_csg_rds * (0.005 + 0.051 + 0.024)

#Enlever le montant de la prévoyance
salaire_net -= taux_de_la_tranche(fixed=True, codes_list=['1_charges_salariales_mutuelle'])

return arrondir(salaire_net, 0.01)</field>
            <field name="status">validated</field>
            <field name="type_">benefit_net_salary_calculation</field>
            <field name="context" ref="rule_engine.default_context"/>
        </record>
        <record model="extra_data" id="net_salary_contibution_urssaf_1">
            <field name="name">1_urssaf_1</field>
            <field name="type_">numeric</field>
            <field name="string">URSAFF 1</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_urssaf_2">
            <field name="name">1_urssaf_2</field>
            <field name="type_">numeric</field>
            <field name="string">URSAFF 2</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_urssaf_3">
            <field name="name">1_urssaf_3</field>
            <field name="type_">numeric</field>
            <field name="string">URSAFF 3</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_urssaf_4">
            <field name="name">1_urssaf_4</field>
            <field name="type_">numeric</field>
            <field name="string">URSAFF 4</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_retraite_1">
            <field name="name">2_retraite_1</field>
            <field name="type_">numeric</field>
            <field name="string">Retraite 1</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_retraite_2">
            <field name="name">2_retraite_2</field>
            <field name="type_">numeric</field>
            <field name="string">Retraite 2</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_prevoyance_1">
            <field name="name">3_prevoyance_1</field>
            <field name="type_">numeric</field>
            <field name="string">Prevoyance 1</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_prevoyance_2">
            <field name="name">3_prevoyance_2</field>
            <field name="type_">numeric</field>
            <field name="string">Prevoyance 2</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_chomage_1">
            <field name="name">4_chomage_1</field>
            <field name="type_">numeric</field>
            <field name="string">Chomage 1</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_chomage_2">
            <field name="name">4_chomage_2</field>
            <field name="type_">numeric</field>
            <field name="string">Chomage 2</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_charges_patronales_prevoyance">
            <field name="name">5_charges_patronales_prevoyance</field>
            <field name="type_">numeric</field>
            <field name="string">Charges PATRONALES prévoyance (taux)</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_charges_salariales_sante_taux">
            <field name="name">6_charges_salariales_sante_taux</field>
            <field name="type_">numeric</field>
            <field name="string">Charges SALARIALES santé (si taux)</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_charges_patronales_sante_taux">
            <field name="name">6_charges_patronales_sante_taux</field>
            <field name="type_">numeric</field>
            <field name="string">Charges PATRONALES santé (si taux)</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_1_charges_salariales_mutuelle">
            <field name="name">1_charges_salariales_mutuelle</field>
            <field name="type_">numeric</field>
            <field name="string">Charges SALARIALES santé (si montant)</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="extra_data" id="net_salary_contibution_2_charges_patronales_montant">
            <field name="name">2_charges_patronales_sante_montant</field>
            <field name="type_">numeric</field>
            <field name="string">Charges PATRONALES santé (si montant)</field>
            <field name="kind">salary</field>
            <field name="digits">4</field>
        </record>
        <record model="claim.net_calculation_rule" id="net_indemnification_rule_contributions_definition">
            <field name="name">Calcul du NET à payer</field>
            <field name="rule" ref="net_salary_calculation_a_payer"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_urssaf_1">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_urssaf_1"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_urssaf_2">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_urssaf_2"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_urssaf_3">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_urssaf_3"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_urssaf_4">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_urssaf_4"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_retraite_1">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_retraite_1"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_retraite_2">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_retraite_2"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_prevoyance_1">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_prevoyance_1"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_prevoyance_2">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_prevoyance_2"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_chomage_1">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_chomage_1"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_chomage_2">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_chomage_2"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_charges_patronales_prevoyance">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_charges_patronales_prevoyance"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_charges_salariales_sante_taux">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_charges_salariales_sante_taux"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_charges_patronales_sante_taux">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_charges_patronales_sante_taux"/>
        </record>
        <record model="net_calculation_rule-fix_extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_1_charges_salariales_mutuelle">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_1_charges_salariales_mutuelle"/>
        </record>
        <record model="net_calculation_rule-fix_extra_data" id="net_indemnification_rule_contributions_definition_net_salary_contibution_2_charges_patronales_montant">
            <field name="calculation_rule" ref="net_indemnification_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_2_charges_patronales_montant"/>
        </record>
        <record model="claim.net_calculation_rule" id="net_indemnification_imposable_rule_contributions_definition">
            <field name="name">Calcul du NET imposable</field>
            <field name="rule" ref="net_salary_calculation_imposable"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_urssaf_1">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_urssaf_1"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_urssaf_2">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_urssaf_2"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_urssaf_3">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_urssaf_3"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_urssaf_4">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_urssaf_4"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_retraite_1">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_retraite_1"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_retraite_2">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_retraite_2"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_prevoyance_1">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_prevoyance_1"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_prevoyance_2">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_prevoyance_2"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_chomage_1">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_chomage_1"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_chomage_2">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_chomage_2"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_charges_patronales_prevoyance">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_charges_patronales_prevoyance"/>
        </record>
        <record model="net_calculation_rule-extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_charges_patronales_sante_taux">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_charges_patronales_sante_taux"/>
        </record>
        <record model="net_calculation_rule-fix_extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_1_charges_salariales_mutuelle">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_1_charges_salariales_mutuelle"/>
        </record>
        <record model="net_calculation_rule-fix_extra_data" id="net_indemnification_imposable_rule_contributions_definition_net_salary_contibution_2_charges_patronales_montant">
            <field name="calculation_rule" ref="net_indemnification_imposable_rule_contributions_definition"/>
            <field name="extra_data" ref="net_salary_contibution_2_charges_patronales_montant"/>
        </record>
    </data>
</tryton>
