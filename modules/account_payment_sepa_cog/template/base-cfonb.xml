<?xml version="1.0" encoding="UTF-8"?>
<!-- This file is part of Tryton.  The COPYRIGHT file at the top level of
this repository contains the full copyright notices and license terms. -->
<py:strip xmlns:py="http://genshi.edgewall.org/">
    <!-- CFONB forbid PstlAdr -->
    <py:def function="PartyIdentification(party, id=True, name=True)">
        <!-- EPC limits to 70 instead of 140 -->
        <Nm py:if="name">${party.name[:70]}</Nm>
        <py:with vars="address = party.address_get()">
            <PstlAdr py:if="address">
                ${PostalAddress(address)}
            </PstlAdr>
        </py:with>
        <Id py:if="id and party.sepa_creditor_identifier_used">
            <PrvtId>
                <Othr>
                    <Id>${party.sepa_creditor_identifier_used}</Id>
                    <SchmeNm>
                        <Prtry>SEPA</Prtry>
                    </SchmeNm>
                    <!-- Issr -->
                </Othr>
            </PrvtId>
        </Id>
        <!-- CtryOfRes -->
        <!-- CtctDtls -->
    </py:def>
    <py:def function="PostalAddress(address)">
        <!-- AdrTp -->
        <!-- Dept -->
        <!-- SubDept -->
        <!-- <StrtNm py:if="address.street_for_sepa()">${address.street_for_sepa()[:70]}</StrtNm> -->
        <!-- BldgNb -->
        <PstCd py:if="address.zip">${normalize('NFKD', address.zip).encode('ascii', 'replace').decode('ascii')[:16]}</PstCd>
        <TwnNm py:if="address.city">${normalize('NFKD', address.city).encode('ascii', 'replace').decode('ascii')[:35]}</TwnNm>
        <CtrySubDvsn py:if="address.subdivision">${normalize('NFKD',address.subdivision.rec_name).encode('ascii', 'replace').decode('ascii')[:35]}</CtrySubDvsn>
        <Ctry py:if="address.country">${normalize('NFKD', address.country.code).encode('ascii', 'replace').decode('ascii')}</Ctry>
        <AdrLine py:if="address.sepa_adrline_1">${address.sepa_adrline_1}</AdrLine>
        <AdrLine py:if="address.sepa_adrline_2">${address.sepa_adrline_2}</AdrLine>
    </py:def>
</py:strip>
