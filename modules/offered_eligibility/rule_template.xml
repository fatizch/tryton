<?xml version="1.0" encoding="utf-8"?>
<tryton>
    <data>
        <record model="rule_engine" id="option_eligibility_on_age">
            <field name="name">Option Eligibility Rule</field>
            <field name="short_name">option_age_eligibility</field>
            <field name="algorithm">birth_year = date_de_naissance().timetuple()[0]
age = 0 
if param_age_kind() == 'real':
    age = relativedelta(date_debut_souscription(), date_de_naissance()).years
elif param_age_kind() == 'at_end_of_month':
    birthday_month_after = date_de_naissance() + relativedelta(months=1)
    year, month, _ = birthday_month_after.timetuple()[0:3]
    first_day_following_month = datetime.date(year, month, 1)  
    age = relativedelta(date_debut_souscription(), first_day_following_month).years
elif param_age_kind() == 'at_given_day_of_year':
    given_date_in_birth_year = datetime.date(birth_year,
        int(param_given_month()), int(param_given_day()))
    age = relativedelta(date_debut_souscription(), given_date_in_birth_year).years
return param_max_age_for_option() > age</field>
            <field name="status">validated</field>
            <field name="type_">eligibility</field>
            <field name="context" ref="rule_engine.default_context"/>
        </record>
        <record model="rule_engine.rule_parameter" id="option_max_age">
            <field name="name">max_age_for_option</field>
            <field name="type_">integer</field>
            <field name="string">Maximum age for option (age included)</field>
            <field name="parent_rule" ref="option_eligibility_on_age"/>
        </record>
        <record model="rule_engine.rule_parameter" id="option_age_kind">
            <field name="name">age_kind</field>
            <field name="type_">selection</field>
            <field name="selection">real : Real
at_given_day_of_year : At Given Day of Year
at_end_of_month : At End of Month</field>
            <field name="string">Age kind for eligibility rule</field>
            <field name="parent_rule" ref="option_eligibility_on_age"/>
        </record>
        <record model="rule_engine.rule_parameter" id="given_day">
            <field name="name">given_day</field>
            <field name="type_">selection</field>
            <field name="selection">1 : 1
2 : 2
3 : 3
4 : 4
5 : 5
6 : 6
7 : 7
8 : 8
9 : 9
10 : 10
11 : 11
12 : 12
13 : 13
14 : 14
15 : 15
16 : 16
17 : 17
18 : 18
19 : 19
20 : 20
21 : 21
22 : 22
23 : 23
24 : 24
25 : 25
26 : 26
27 : 27
28 : 28
29 : 29
30 : 30
31 : 31</field>
            <field name="selection_sorted">False</field>
            <field name="string">Given Day</field>
            <field name="parent_rule" ref="option_eligibility_on_age"/>
        </record>
        <record model="rule_engine.rule_parameter" id="given_month">
            <field name="name">given_month</field>
            <field name="type_">selection</field>
            <field name="selection">1 : 1
2 : 2
3 : 3
4 : 4
5 : 5
6 : 6
7 : 7
8 : 8
9 : 9
10 : 10
11 : 11
12 : 12</field>
            <field name="selection_sorted">False</field>
            <field name="string">Given Month</field>
            <field name="parent_rule" ref="option_eligibility_on_age"/>
        </record>
    </data>
</tryton>
